#!/usr/bin/env zsh

get_cmus_info ()
{
  echo $(cmus-remote -Q | grep $1 | awk '{ $1=""; print }' | sed 's/^ *//' | sed 's/ *$//' 2>/dev/null)
}

cmus_echo ()
{
  echo $(get_cmus_info $1)
}

cmus_display ()
{
  STREAM=`echo $(cmus_echo $1) | sed 's/"/\\"/g'`
  return $(terminal-notifier -sender com.apple.iTunes -title $'C* Music Player' -message "$STREAM")
}

toggle ()
{
  STATUS=$(get_cmus_info status)
  if [[ "$STATUS" == "playing" ]]; then
    cmus_display stream
    $(cmus-remote -s) # or s to stop
  else if [[ "$STATUS" == "stopped" || "$STATUS" == "paused" ]]; then
      $(cmus-remote -p)
      cmus_display stream
    fi
  fi
}

toggle
